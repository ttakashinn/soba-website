---
export interface Props {
  id: string
  industry: string
  client: string
  teamSize: string
  heroImage: string
  challenge: string
  results: Array<{ icon: string; text: string }>
  tech: string[]
  timeline: string
  labels: {
    challenge: string
    viewDetails: string
  }
}

const {
  id,
  industry,
  client,
  teamSize,
  heroImage,
  challenge,
  results,
  tech,
  timeline,
  labels,
} = Astro.props

// Map industry to emoji for fallback
const industryEmojis: Record<string, string> = {
  manufacturing: 'ğŸ­',
  fnb: 'ğŸ½ï¸',
  logistics: 'ğŸšš',
  default: 'ğŸ’¼',
}

const getIndustryEmoji = (ind: string) => {
  const key = ind.toLowerCase().replace(/[^a-z]/g, '')
  if (
    key.includes('sáº£n') ||
    key.includes('manufacturing') ||
    key.includes('è£½é€ ')
  )
    return 'ğŸ­'
  if (key.includes('f&b') || key.includes('fnb') || key.includes('restaurant'))
    return 'ğŸ½ï¸'
  if (key.includes('logistics') || key.includes('ç‰©æµ')) return 'ğŸšš'
  return 'ğŸ’¼'
}
---

<div
  class='group bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 border border-gray-100 case-study-card'
  data-industry={industry}>
  <!-- Hero Image -->
  <div
    class='relative h-48 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center overflow-hidden'>
    <img
      src={heroImage}
      alt={client}
      class='w-full h-full object-cover hero-image'
      loading='lazy'
      onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
    />
    <span
      class='text-7xl hidden items-center justify-center'
      aria-hidden='true'
      style='display: none;'>{getIndustryEmoji(industry)}</span
    >
    <div class='absolute top-4 left-4'>
      <span
        class='bg-white/90 text-gray-800 px-3 py-1 rounded-full text-sm font-medium'>
        {industry}
      </span>
    </div>
  </div>

  <!-- Content -->
  <div class='p-6'>
    <h3
      class='text-xl font-bold text-gray-900 mb-2 group-hover:text-indigo-600 transition-colors'>
      {client}
    </h3>
    <p class='text-gray-500 text-sm mb-4'>{teamSize} â€¢ {timeline}</p>

    <!-- Challenge -->
    <div class='mb-4'>
      <span class='text-red-600 font-medium text-sm'>{labels.challenge}:</span>
      <p class='text-gray-600 text-sm mt-1 line-clamp-2'>{challenge}</p>
    </div>

    <!-- Results Preview -->
    <div class='flex flex-col gap-2 mb-4'>
      {
        results.slice(0, 2).map((result) => (
          <span class='flex items-center gap-1 bg-green-50 text-green-700 px-2 py-1 rounded text-xs truncate'>
            <span class='flex-shrink-0'>{result.icon}</span>
            <span class='truncate'>{result.text}</span>
          </span>
        ))
      }
    </div>

    <!-- Tech Stack -->
    <div class='flex flex-wrap gap-2 mb-4'>
      {
        tech.map((t) => (
          <span class='bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-medium'>
            {t}
          </span>
        ))
      }
    </div>

    <!-- View Details Button -->
    <button
      @click={`$dispatch('open-modal', { id: '${id}' })`}
      class='w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2'
      aria-label={`${labels.viewDetails} - ${client}`}>
      {labels.viewDetails}
      <svg
        class='w-4 h-4'
        fill='none'
        stroke='currentColor'
        viewBox='0 0 24 24'
        aria-hidden='true'>
        <path
          stroke-linecap='round'
          stroke-linejoin='round'
          stroke-width='2'
          d='M17 8l4 4m0 0l-4 4m4-4H3'></path>
      </svg>
    </button>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
